{% extends "base.html" %}
{% block scripts %}
{{ super() }}
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
    function cb(selection) {
        $.getJSON({
            url: "/callback", data: { 'data': selection, 'folder':"{{ folder }}" }, success: function (result) {
                Plotly.newPlot('chart', result, {staticPlot: true});;
            }
        });
        if (selection == 'transmission') {
        $("#RI").prop("href", "{{ url_for('send_report', filename=folder+'/transmission/Transmission_*-RI.txt')}}");
        $("#YJ").prop("href", "{{ url_for('send_report', filename=folder+'/transmission/Transmission_YJ.txt')}}");
        $("#H").prop("href", "{{ url_for('send_report', filename=folder+'/transmission/Transmission_*-H.txt')}}")};
        if (selection == 'SN') {
        $("#RI").prop("href", "{{ url_for('send_report', filename=folder+'/SN/signal_to_noise_*-RI.txt')}}");
        $("#YJ").prop("href", "{{ url_for('send_report', filename=folder+'/SN/signal_to_noise_YJ.txt')}}");
        $("#H").prop("href", "{{ url_for('send_report', filename=folder+'/SN/signal_to_noise_*-H.txt')}}")};
        if (selection == 'obj_spec') {
        $("#RI").prop("href", "{{ url_for('send_report', filename=folder+'/obj_spec/object_spectrum_*-RI.txt')}}");
        $("#YJ").prop("href", "{{ url_for('send_report', filename=folder+'/obj_spec/object_spectrum_YJ.txt')}}");
        $("#H").prop("href", "{{ url_for('send_report', filename=folder+'/obj_spec/object_spectrum_*-H.txt')}}")};
    }
</script>

<script>
    d = {{ graphJSON | safe }};
    //d.config={staticPlot: true};
    Plotly.newPlot('chart', d, {});
</script>
{% endblock %}

{% block content %}
<div class="container">
    <hr>
    <div class="row">
        <div class="col-6">
            <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg example" autocomplete="off" onchange="cb(this.value)">
                <option selected="SN">Signal-to-Noise Ratio</option>
                <option value="obj_spec">Object Spectrum</option>
                <option value="transmission">Transmission</option>
            </select> 
        </div>
        <div class="col-3">
            <div class="dropdown">
                <a class="btn btn-primary btn-lg dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  Download Data
                </a>
              
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" id='RI' href="{{ url_for('send_report', filename=folder+'/SN/signal_to_noise_HR-RI.txt')}}">RI</a></li>
                  <li><a class="dropdown-item" id='YJ' href="{{ url_for('send_report', filename=folder+'/SN/signal_to_noise_YJ.txt')}}">YJ</a></li>
                  <li><a class="dropdown-item" id='H' href="{{ url_for('send_report', filename=folder+'/SN/signal_to_noise_HR-H.txt')}}">H</a></li>
                </ul>
              </div>
        </div>
    </div>
    <div id="chart" class="chart"></div>
</div>
{% endblock %}